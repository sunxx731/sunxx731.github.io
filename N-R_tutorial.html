<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>A Tutorial on novelty and relevance metrics</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/paper.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 64px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h2 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h3 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h4 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h5 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h6 {
  padding-top: 69px;
  margin-top: -69px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="research.html">Research</a>
</li>
<li>
  <a href="teaching.html">Teaching</a>
</li>
<li>
  <a href="N-R_tutorial.html">Novelty &amp; Relevance Metrics</a>
</li>
<li>
  <a href="contact.html">Contact</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="contact.html">
    <span class="fa fa-envelope fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://www.linkedin.com/in/bixuan-sun-2a700849/">
    <span class="fa fa-linkedin fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">A Tutorial on novelty and relevance metrics</h1>

</div>


<p><strong>Author</strong>: Bixuan Sun, Ph.D. (<a href="mailto:sunxx731@umn.edu">sunxx731@umn.edu</a>)</p>
<p><strong>Full paper</strong>: Sun, Bixuan; Kolesnikov, Sergey; Goldstein, Anna; Chan, Gabriel. “A Dynamic Approach for Identifying Technological Breakthroughs with an Application in Solar Photovoltaics”</p>
<div id="overview" class="section level2">
<h2>Overview</h2>
<p>This is R tutorial on how to (1) extract relevant patents from PatentsView for analysis; (2) build and tune topic model; (3) calculate novelty and relevance metrics; (4) additional analyses using novelty and relevance mmtrics.</p>
</div>
<div id="step-1-download-relavant-files-and-select-patent-sample" class="section level2">
<h2>Step 1: Download relavant files and select patent sample</h2>
<p>Go to <a href="https://www.patentsview.org/download/">PatentsView</a> and download the following files: (1) Data on granted patents: <em>patent.tsv</em>; (2) Current CPC classification data for all patents (applied retrospectively to all patents): <em>cpc_current.tsv</em>; (3) Detailed patent description text: <em>detail_desc_text.tsv</em> (provided upon request to <a href="mailto:contact@patentsview.org">contact@patentsview.org</a>).</p>
<p>Next, import <em>cpc_current.tsv</em> and <em>patent.tsv</em> into RStudio and select relevant patents for future analysis.</p>
<pre class="r"><code>rm(list=ls())  #clear existing memory
library(&#39;data.table&#39;) 
root.direct = c(&quot;E:/USPTO/&quot;) #set root directory

############# identify patents with Si related CPC classes #################
cpc = fread(paste(root.direct, &#39;cpc_current.tsv&#39;, sep=&quot;&quot;)) #import cpc data file
si.cpc = c(&quot;Y02E10/545&quot;,&quot;Y02E10/546&quot;,&quot;Y02E10/547&quot;, &quot;Y02E10/548&quot;) #four specific CPC classes
si.patent.ids = cpc[subgroup_id %in% si.cpc, ]$patent_id #patent numbers of Si related patents
uniqueN(si.patent.ids) #number of Si related patents

pats = fread(paste(root.direct, &#39;patent.tsv&#39;, sep=&quot;&quot;)) #import patent data file
pats[,granted_year:=substr(date,1,4)] #create a variable of granted year
si.pv.pats = pats[(id %in% si.patent.ids) &amp; (granted_year&lt;=2016) &amp; (granted_year&gt;=1976)] #information on Si related patents granted between 1976 and 2016
nrow(si.pv.pats) #number of patents in the sample
head(si.pv.pats) #preview of patent information
write.csv(si.pv.pats, file =  paste(root.direct, &#39;silicon_patents.csv&#39;, sep=&quot;&quot;), row.names = F) #export patent information as csv file</code></pre>
<p>The datasets on patent full-texts are organized by year, therefore we need to import and screen for the si-related patent full-text by year. If there are patents with missing full-text from the database, we might need to manually add them to the dataset.</p>
<pre class="r"><code>################## import silicon PV patent text ################## 
si.pv.text = fread(paste(root.direct, &#39;detail_desc_text/detail-desc-text-&#39;,1976,&#39;.tsv&#39;, sep=&quot;&quot;), nrows = 0)
for (n in 1976:2016){
  full.text = fread(paste(root.direct, &#39;detail_desc_text/detail-desc-text-&#39;,n,&#39;.tsv&#39;, sep=&quot;&quot;))
  si.pv.text.1 = full.text[patent_id %in% si.pats$id]
  
  si.pv.text = rbind(si.pv.text, si.pv.text.1)
}

write.csv(si.pv.text, file =  paste(root.direct, &#39;silicon_patents_full_text.csv&#39;, sep=&quot;&quot;), row.names = F)

#Now check if there are missing patents in the full-text dataset
full.text.pat.ids = si.pv.text$patent_id
missing.ids = si.pats$id[!(si.pats$id %in% full.text.pat.ids)] #ids of the patents with missing full-text</code></pre>
</div>
<div id="step-2-build-topic-model" class="section level2">
<h2>Step 2: Build topic model</h2>
<p>In this step, we first construct the document-feature matrix for the topic model, then we use cross validation to determine the number of topics, finally we create the topic model and the resulting topic distribution matrix for the relevant patents.</p>
<pre class="r"><code>rm(list=ls())
library(&#39;data.table&#39;) 
root.direct = c(&quot;E:/USPTO/&quot;)

si.pv.text = fread(paste(root.direct, &#39;silicon_patents_full_text.csv&#39;, sep=&quot;&quot;)) #import full texts
all.text = si.pv.text$detail_description_text #creating a vector of full texts
corpus = tolower(all.text) #convert all texts to lower case</code></pre>
<div id="construct-document-feature-matrix" class="section level3">
<h3>2.1. Construct document-feature matrix</h3>
<pre class="r"><code>library(quanteda)  #install package before use

tokens = tokens(corpus, what = &quot;word&quot;, 
                remove_numbers = F, remove_punct = T,
                remove_symbols = F, remove_hyphens = F)

# perform stemming on tokens
tokens = tokens_wordstem(tokens, language=&quot;english&quot;)

# delete list of stopwords 
stopwords(&quot;english&quot;) #quanteda built in stopword
stoplist =fread(paste(&quot;E:/PATSTAT Data/&quot;, c(&quot;text_mining/stoplist.csv&quot;), sep = &quot;&quot;))
stoplist = unique(stoplist$stopwords)

sw = unique(c(stopwords(&quot;english&quot;),stoplist, &quot;also&quot;,&quot;e.g&quot;, &quot;can&quot;,&quot;includ&quot;,&quot;said&quot;,&quot;first&quot;,&quot;wherein&quot;,&quot;other&quot;,&quot;made&quot;,&quot;make&quot;, &quot;later&quot;,  &quot;copyright&quot;, &quot;fig&quot;, &quot;figur&quot;, &quot;tabl&quot;, &quot;description&quot;, &quot;describ&quot;))

tokens = tokens_select(tokens, sw,  selection = &quot;remove&quot;)

# Create  bag-of-words mode
tokens.dfm = dfm(tokens, tolower = FALSE)

dfm = dfm_trim(tokens.dfm, min_termfreq = 10, termfreq_type=&quot;count&quot;) #set minimum term frequency to be 10
dim(dfm) 

##################### delete additional stopwords #######################
terms = colnames(dfm)

### delete single letter and number
singles = terms[nchar(terms)==1] #44
terms = terms[nchar(terms)!=1]

#### delete two-letter
doubles = terms[nchar(terms)==2] #911
terms = terms[nchar(terms)!=2] 

#### add some important two letter terms
chemical = fread(paste(&quot;E:/PATSTAT Data/&quot;, c(&quot;text_mining/chemicals.csv&quot;), sep = &quot;&quot;))
A =c(singles, doubles)
append.1 = A[A %in% c(tolower(chemical$terms),  c(&quot;ac&quot;,&quot;dc&quot;,&quot;o2&quot;,&quot;o3&quot;,&quot;s2&quot;,&quot;h2&quot;,&quot;n2&quot;,&quot;i2&quot;,&quot;ii&quot;,&quot;iv&quot;,&quot;vi&quot;))]

terms = c(terms, append.1)

#terms with numbers
C = terms[grep(&quot;[0-9][0-9][A-Za-z]&quot;,terms,perl = T)]
D = terms[grep(&quot;[A-Za-z][0-9][0-9]&quot;,terms,perl = T)] #terms with number

C[nchar(C)&gt;=3 &amp; nchar(C)&lt;=9]
D[nchar(D)&lt;=4 &amp; nchar(D)&gt;=3]

deleted.num = c(C[nchar(C)&gt;=3 &amp; nchar(C)&lt;=9], D[nchar(D)&lt;=4 &amp; nchar(D)&gt;=3])
terms = terms[!(terms %in% deleted.num)]

#delete all terms starting with purpose
terms = terms[!(terms %in% terms[grep(&quot;purpose:&quot;,terms,perl=T)])]

# remove terms with two-digit number or more
E = unique(c(terms[grep(&quot;[0-9][0-9]&quot;,terms,perl = T)],terms[grep(&quot;[0-9],[0-9]&quot;,terms,perl = T)]
             ,terms[grep(&quot;[0-9]-[0-9]&quot;,terms,perl = T)], terms[grep(&quot;[0-9]\\.[0-9]&quot;,terms,perl = T)]))
E[grep(&quot;[A-Za-z]&quot;,E,perl = T)]
terms = terms[!(terms %in% E[-grep(&quot;[A-Za-z]&quot;,E,perl = T)])] #keep the ones with letters


# remove all units pf distance
G = c(&quot;0.1m&quot;,
      terms[grep(&quot;[0-9]mm&quot;,terms,perl = T)],
      terms[grep(&quot;[0-9]mum&quot;,terms,perl = T)],
      terms[grep(&quot;[0-9]mol&quot;,terms,perl = T)],
      terms[grep(&quot;[0-9]cm&quot;,terms,perl = T)],
      terms[grep(&quot;[0-9]nm&quot;,terms,perl = T)],
      terms[grep(&quot;[0-9]æ¼ã¸²&quot;,terms,perl = T)],
      terms[grep(&quot;[0-9]angstrom&quot;,terms,perl = T)])

terms = terms[!(terms %in% G)]

## trim the matrix
dfm = dfm[,terms]
dim(dfm) 

save(dfm, file = paste(root.direct,c(&quot;dfm_min10_si_pv_full_text.Rdata&quot;), sep=&quot;&quot;))  #export the document-feature matrix</code></pre>
</div>
<div id="cross-validation-to-determine-the-number-of-topics" class="section level3">
<h3>2.2. Cross validation to determine the number of topics</h3>
<pre class="r"><code>#install and import packages
library(&quot;topicmodels&quot;)
library(&quot;ggplot2&quot;)
library(&quot;scales&quot;)
library(&quot;ldatuning&quot;)
load(paste(root.direct,c(&quot;dfm_min10_si_pv_full_text.Rdata&quot;), sep=&quot;&quot;)) #import the saved document-feature matrix

set.seed(123)

dfm = dfm[which(rowSums(dfm) &gt; 0),] #delete rows with zeros
dtm = convert(dfm,to=&quot;topicmodels&quot;) #need to convert to document term matrix which can be used by topicmodels package
dim(dtm)

######## cross-validation, different numbers of topics ############
result &lt;- FindTopicsNumber(
  dtm,
  topics = c(75, 100, 125, 150, 175, 200, 225, 250, 275, 300),
  metrics = c(&quot;Griffiths2004&quot;, &quot;CaoJuan2009&quot;, &quot;Arun2010&quot;, &quot;Deveaud2014&quot;),
  method = &quot;Gibbs&quot;,
  control = list(seed = 77),
  mc.cores = 2L,
  verbose = TRUE
)
 
FindTopicsNumber_plot(result) #inspect graphic output to determine the optimal number of topics</code></pre>
<div class="figure">
<img src="C:/Users/sunxx731/Google%20Drive/Innovation%20Spillover/@Analytics/USPTO/Public%20code/topic_model_CV.png" alt="Figure 1. Cross validation on the number of topics" />
<p class="caption">Figure 1. Cross validation on the number of topics</p>
</div>
</div>
<div id="build-lda-topic-model-and-calculate-topic-distribution-matrix" class="section level3">
<h3>2.3. Build LDA topic model and calculate topic distribution matrix</h3>
<pre class="r"><code>library(&quot;topicmodels&quot;)
library(&quot;tidytext&quot;)
library(&quot;tm&quot;)

######################### fit LDA model #################################
dfm = dfm[which(rowSums(dfm) &gt; 0),] #delete rows with zeros
dtm = convert(dfm,to=&quot;topicmodels&quot;) #need to convert to document term matrix which can be used by topicmodels package
dim(dtm) # 3126 10399

lda.model = LDA(dtm,k = 200, control = list(seed = 123),alpha = 0.1, beta = 0.01 , verbose=1) 
save(lda.model, file = paste(root.direct,c(&quot;lda_si_pv_full_text_200_topics_min10.RDS&quot;), sep=&quot;&quot;))


################# calculate topic distribution matrix ####################
lda.matrix = posterior(lda.model,dfm)$topics
dim(lda.matrix) 
rownames(lda.matrix) = si.pv.text$patent_id #replace the matrix row names with patent numbers

save(lda.matrix, file = paste(root.direct,c(&quot;topic_dist_si_pv_full_text_200_topics_min10.Rdata&quot;), sep=&quot;&quot;))</code></pre>
</div>
</div>
<div id="step-3-calculate-novelty-and-relevance-metrics" class="section level2">
<h2>Step 3: Calculate novelty and relevance metrics</h2>
<p>To calculate novelty and relevance metrics, we first obtain the average topic distribution for each year (annual field centroids), then write a function that calculates the 20-year novelty and relevance metrics for patents filed in a given year, finally create a dataset that includes the changes/slopes of novelty and relevance values, initial novelty and relevance values of each patent in the study period.</p>
<div id="annual-field-centroids" class="section level3">
<h3>3.1. Annual field centroids</h3>
</div>
<div id="calculate-novelty-and-relevance-metrics" class="section level3">
<h3>3.2. Calculate novelty and relevance metrics</h3>
<p>Write a function <em>distance.function(n)</em> where <em>n</em> is the granted year of the patents to be evaluated.</p>
</div>
<div id="calculate-slopes-of-novelty-and-relevance-for-each-patent" class="section level3">
<h3>3.3. Calculate slopes of novelty and relevance for each patent</h3>
<p>Create a dataset that includes the changes/slopes of novelty and relevance values, initial novelty and relevance values of each patent in the study period. This dataset can be used for further qualitative validations.</p>
<pre class="r"><code>slope.dt.1 = data.table(id=as.character(),granted_year=as.integer(),initial_novelty=as.numeric(),initial_novelty_percentile=numeric(),
                        initial_relevance=as.numeric(),initial_relevance_percentile=numeric(),
                        novelty_slope=as.numeric(),relevance_slope=as.numeric(), 
                        novelty_slope_first10=numeric(), relevance_slope_first10=numeric(),
                        novelty_slope_last10=numeric(), relevance_slope_last10=numeric())

for (k in 1977:1996){
  patent.distance = distance.function(k)
  between.ids = unique(patent.distance$id)
  
  #### calculate slope of novelty and relevance for each patent, between 1995 and 2005 #######
  slope.dt = data.table(between.ids)
  setnames(slope.dt,&quot;id&quot;)
  
  slope.dt[,granted_year:=k]
  
  initial.novelty.vec = patent.distance[time_trend==1]$novelty
  initial.relevance.vec = patent.distance[time_trend==1]$relevance
  
  
  for (x in 1:length(between.ids)){
    slope.dt[id==between.ids[x],initial_novelty:=100*patent.distance[id==between.ids[x] &amp; time_trend==1]$novelty]
    slope.dt[id==between.ids[x],initial_novelty_percentile:=length(initial.novelty.vec[initial.novelty.vec&lt;patent.distance[id==between.ids[x] &amp; time_trend==1]$novelty])/length(initial.novelty.vec)]
    
    slope.dt[id==between.ids[x],initial_relevance:=100*patent.distance[id==between.ids[x] &amp; time_trend==1]$relevance]
    slope.dt[id==between.ids[x],initial_relevance_percentile:=length(initial.relevance.vec[initial.relevance.vec&lt;patent.distance[id==between.ids[x] &amp; time_trend==1]$relevance])/length(initial.relevance.vec)]
    
    
    
    slope.dt[id==between.ids[x],novelty_slope:=coef(lm((100*novelty) ~ time_trend,data = patent.distance[id==between.ids[x]]))[2]]
    slope.dt[id==between.ids[x],relevance_slope:=coef(lm((100*relevance) ~ time_trend,data = patent.distance[id==between.ids[x]]))[2]]
    
    slope.dt[id==between.ids[x],novelty_slope_first10:=coef(lm((100*novelty) ~ time_trend,data = patent.distance[id==between.ids[x]][1:10]))[2]]
    slope.dt[id==between.ids[x],relevance_slope_first10:=coef(lm((100*relevance) ~ time_trend,data = patent.distance[id==between.ids[x]][1:10]))[2]]
    
    slope.dt[id==between.ids[x],novelty_slope_last10:=coef(lm((100*novelty) ~ time_trend,data = patent.distance[id==between.ids[x]][10:20]))[2]]
    slope.dt[id==between.ids[x],relevance_slope_last10:=coef(lm((100*relevance) ~ time_trend,data = patent.distance[id==between.ids[x]][10:20]))[2]]
    
  }
  
  slope.dt.1 = rbind(slope.dt.1,slope.dt)
}

slope.dt.1
write.csv(slope.dt.1, file = paste(root.direct,c(&quot;slope_1977-1996_full_text_200_topics.csv&quot;),sep = &quot;&quot;), row.names = F)</code></pre>
</div>
</div>
<div id="additional-quantitative-analysis" class="section level2">
<h2>Additional quantitative analysis</h2>
<div id="plot-the-novelty-and-relevance-values-of-known-breakthrough-patents" class="section level3">
<h3>(1) Plot the novelty and relevance values of known breakthrough patents</h3>
<pre class="r"><code>library(&#39;data.table&#39;) 
library(&quot;ggplot2&quot;)

slope.dt.1 = fread(paste(root.direct,c(&quot;slope_1977-1996_full_text_200_topics.csv&quot;),sep = &quot;&quot;)) #import dataset created in section 3.3.

pat.id = 4086102 #a breakthrough patent from Nemet &amp; Husmann (2012)   
patent.distance.1 = distance.function(as.numeric(silicon.pv.pats[id==pat.id]$granted_year))  #distance.function created in section 3.2.

{nov.1 = ggplot(patent.distance.1[id==pat.id], aes(x=ending_centroid_yr, y=novelty*100)) + geom_point(shape=16) + geom_smooth(method=lm, se=F) +
    geom_line() + labs(y=c(&quot;N&quot;)) +   theme(axis.title.x=element_blank(),
                           axis.text.x=element_blank(), axis.text.y=element_blank(),
                           axis.ticks.x=element_blank())

rel.1 = ggplot(patent.distance.1[id==pat.id], aes(x=ending_centroid_yr, y=relevance*100)) + geom_point(shape=16) + geom_smooth(method=lm, se=F) +
    geom_line() +labs(y=c(&quot;R&quot;)) +   theme(axis.title.x=element_blank(),
                           axis.text.x=element_blank(),axis.text.y=element_blank(),
                           axis.ticks.x=element_blank())

plot_grid(nov.1, rel.1,hjust = 0, vjust = 1,align = &quot;h&quot;, ncol=1,nrow=2, scale = c(1., 1.))}</code></pre>
<div class="figure">
<img src="C:/Users/sunxx731/Google%20Drive/Innovation%20Spillover/@Analytics/USPTO/Public%20code/N_R_plot_1.png" alt="Figure 2. Novelty and relevance plot of patent US4086102 with linear trend lines" />
<p class="caption">Figure 2. Novelty and relevance plot of patent US4086102 with linear trend lines</p>
</div>
</div>
<div id="plot-two-linear-trends-and-a-quadratic-trend" class="section level3">
<h3>(2) Plot two linear trends and a quadratic trend</h3>
<pre class="r"><code>pat.id=4843451
patent.distance = distance.function(as.numeric(silicon.pv.pats[id==pat.id]$granted_year))

candidate = patent.distance[id==pat.id]
candidate[time_trend&lt;=15,horizon:=&quot;one&quot;]
candidate[time_trend&gt;15,horizon:=&quot;two&quot;]

# novelty
candidate[horizon==&quot;one&quot;,linear.novel.fitted:=lm(novelty ~ time_trend, candidate[horizon==&quot;one&quot;])$fitted.values]
candidate[horizon==&quot;two&quot;,linear.novel.fitted:=lm(novelty ~ time_trend, candidate[horizon==&quot;two&quot;])$fitted.values]
candidate[,poly.novel.fitted:=lm(novelty ~ poly(time_trend,2), candidate)$fitted.values]
summary(lm(100*novelty ~ poly(time_trend,2, raw = TRUE), candidate))

coefs = coefficients(lm(100*novelty ~ poly(time_trend,2, raw = TRUE), candidate))
-coefs[2]/(2*coefs[3])

# relevance
candidate[horizon==&quot;one&quot;,linear.rel.fitted:=lm(relevance ~ time_trend, candidate[horizon==&quot;one&quot;])$fitted.values]
candidate[horizon==&quot;two&quot;,linear.rel.fitted:=lm(relevance ~ time_trend, candidate[horizon==&quot;two&quot;])$fitted.values]
candidate[,poly.rel.fitted:=lm(relevance ~ poly(time_trend,2), candidate)$fitted.values]
summary(lm(100*relevance ~ poly(time_trend,2, raw = T), candidate))

coefs = coefficients(lm(100*relevance ~ poly(time_trend,2, raw = TRUE), candidate))
-coefs[2]/(2*coefs[3])

{nov = ggplot(candidate, aes(x=ending_centroid_yr, y=novelty*100)) + 
    geom_point(shape=16) + 
    geom_line(aes(x=ending_centroid_yr, y=linear.novel.fitted*100, color=horizon),size=1, linetype=&quot;solid&quot;)+
    geom_line(aes(x=ending_centroid_yr, y=poly.novel.fitted*100),size=1, color = &quot;black&quot;)+
    labs(x=c(&quot;Time trend&quot;),y=c(&quot;Novelty&quot;))  + scale_color_manual(values=c(&quot;blue&quot;, &quot;blue&quot;)) +
    theme_grey() + theme(legend.position=&quot;none&quot;) 
  
  #plot relevance
  rel =  ggplot(candidate, aes(x=ending_centroid_yr, y=relevance*100)) + 
    geom_point(shape=16) + 
    geom_line(aes(x=ending_centroid_yr, y=linear.rel.fitted*100, color=horizon),size=1)+
    geom_line(aes(x=ending_centroid_yr, y=poly.rel.fitted*100),size=1, color = &quot;black&quot;)+
    labs(x=c(&quot;Time trend&quot;),y=c(&quot;Relevance&quot;))  + scale_color_manual(values=c(&quot;blue&quot;, &quot;blue&quot;)) +
    theme_grey() + theme(legend.position=&quot;none&quot;)
  
  plot_grid(nov, rel, hjust = 0, vjust = 1,align = &quot;h&quot;, ncol=2, scale = c(1., 1.))
  
}</code></pre>
<div class="figure">
<img src="C:/Users/sunxx731/Google%20Drive/Innovation%20Spillover/@Analytics/USPTO/Public%20code/N_R_plot_2.png" alt="Figure 3. Novelty and relevance plot of patent US4843451 with linear and quadratic trend lines" />
<p class="caption">Figure 3. Novelty and relevance plot of patent US4843451 with linear and quadratic trend lines</p>
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
